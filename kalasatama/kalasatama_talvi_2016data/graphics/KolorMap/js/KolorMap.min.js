(function(){var l=!0,n=null,p=!1;
KolorMap=function(a,g){function f(){var c=document.createElement("div");c.id="mapdiv_m7";c.style.display="none";document.body.appendChild(c);new mxn.Mapstraction("mapdiv_m7","microsoft7")}this.api=this.api=g;this.domElement=this.domElement=a;this.mxnMap=this.mxnMap=new mxn.Mapstraction(a,g);var d=0,j=new ktools.Map,e=new ktools.Map,b=n,m=n,q=n,t="",u="",v="",w="FFFFFF",x=p,i="",k="",o="",s="",y=p;this.setMapContainer=this.setMapContainer=function(c){i=c};this.setPanoContainer=this.setPanoContainer=
function(c){k=c};this.setTourContainer=this.setTourContainer=function(c){o=c};this.setMapLayer=this.setMapLayer=function(c){s=c};this.getMxnMap=this.getMxnMap=function(){return this.mxnMap};this.getMarkers=this.getMarkers=function(){return j};this.getRadars=this.getRadars=function(){return e};this.getActiveMarker=this.getActiveMarker=function(){return b};this.setActiveMarker=this.setActiveMarker=function(c,h,a){"undefined"==typeof h&&(h=l);"undefined"==typeof a&&(a=l);this.getActiveRadar()&&this.getActiveRadar().hide();
this.getActiveMarker()&&this.getActiveMarker().getAttribute("id")!=c&&this.getActiveMarker().closeBubble();c==n?(this.setActiveRadar(n),b=n):(b=this.getMarkers().item(c),m=this.getRadars().item(c),m!=n&&(this.getMxnMap().changeZoom.fire(),a?m.show():m.hide()),h&&b!=n&&this.getMxnMap().setCenter(b.location,{}))};this.setActiveRadar=this.setActiveRadar=function(c){m=c};this.getActiveRadar=this.getActiveRadar=function(){return m};this.setStartPoint=this.setStartPoint=function(c,h){q={};q.point=c;q.zoom=
h};this.getStartPoint=this.getStartPoint=function(){return q};this.setMapPosition=this.setMapPosition=function(c){t=c};this.getMapPosition=this.getMapPosition=function(){return t};this.setMapSize=this.setMapSize=function(c){u=c};this.getMapSize=this.getMapSize=function(){return u};this.setGraphicsUrl=this.setGraphicsUrl=function(c){v=c};this.getGraphicsUrl=this.getGraphicsUrl=function(){return v};this.setMapZorder=this.setMapZorder=function(c){d=c};this.getMapZorder=this.getMapZorder=function(){return d};
this.setMapResizable=this.setMapResizable=function(c){x=c};this.getMapResizable=this.getMapResizable=function(){return x};this.setBgColor=this.setBgColor=function(c){w=c};this.getBgColor=this.getBgColor=function(){return w};this.geocodePosition=this.geocodePosition=function(c,h,a,b){var d=this,e=this.api;"microsoft"==this.api&&(e="microsoft7",f());(new mxn.Geocoder(e,function(c){(typeof b=="undefined"||b)&&d.getMxnMap().setCenterAndZoom(c[0].point,d.getMxnMap().getZoom());h(c[0].point)},function(){a()})).geocode(c)};
this.addRadar=this.addRadar=function(c,h,a){if("undefined"==typeof h)return n;void 0==a&&(a={quality:8,radius:8E3,color:"#FFFFFF",opacity:0.5,width:1,fillColor:"#FFFFFF",fillOpacity:0.3,heading:0,fov:90,linkToZoom:l});h=new mxn.LatLonPoint(h.lat,h.lon);h=new mxn.Radar(h,a);h.setAttribute("id",c);this.getMxnMap().addRadar(h,p);e.add(c,h);a.linkToZoom&&this.getMxnMap().changeZoom.addHandler(function(c,h){var a=this.getActiveRadar();a!=n&&a.currentZoomLevel!=h.getZoom()&&(a.currentZoomLevel=h.getZoom(),
KolorMap.util.rotation(a,a.center,a.currentViewHeading,this.getMxnMap()))},this);h.hide();return h};this.removeRadar=this.removeRadar=function(c){var h=e.item(c);"undefined"==typeof h||h==n||(this.getActiveRadar()==h&&this.setActiveRadar(n),e.remove(c))};this.addMarker=this.addMarker=function(c,h,a,b,f,d,e,g,i,k){a=new mxn.Marker(a);"undefined"!=typeof e&&""!=e&&("label"==g?a.setLabel(e):"tooltip"==g?a.setInfoTooltip(e):a.setInfoBubble(e));"undefined"!=typeof i&&i&&a.setHover(i);"undefined"!=typeof b&&
""!=b&&a.setIcon(b,f,d);"undefined"!=typeof k&&k&&a.setDraggable(k);a.setAttribute("id",c);a.setAttribute("plugName",h);this.getMxnMap().addMarker(a,p);j.add(c,a);return a};this.removeMarker=this.removeMarker=function(c){var a=j.item(c);"undefined"==typeof a||a==n||(this.getActiveMarker()==a&&this.setActiveMarker(n,p,p),this.getMxnMap().removeMarker(a),j.remove(c))};this.addKmlOverlay=this.addKmlOverlay=function(c,a){"undefined"==typeof a&&(a=p);this.getMxnMap().addOverlay(c,a);if("microsoft7"!=this.api){var b=
this.getMxnMap().getZoom();this.getMxnMap().setZoom(b)}};this.changeProvider=this.changeProvider=function(c,a){this.getMxnMap().swap(c,a);this.getActiveRadar()&&(this.getActiveRadar().show(),this.setActiveRadar(KolorMap.util.rotation(this.getActiveRadar(),this.getActiveRadar().center,this.getActiveRadar().currentViewHeading,this.getActiveRadar().mapstraction)))};this.addControls=this.addControls=function(c,a,b,f,e,d){var g={};c&&(g.zoom="small");a&&(g.pan=l);b&&(g.scale=l);f&&(g.map_type=l);e&&(g.overview=
l);d&&d.streetview&&(g.streetview=l);this.getMxnMap().addControls(g)};this.setMapType=this.setMapType=function(c){switch(strtolower(c)){case "satellite":this.getMxnMap().setMapType(mxn.Mapstraction.SATELLITE);break;case "hybrid":this.getMxnMap().setMapType(mxn.Mapstraction.HYBRID);break;case "physical":this.getMxnMap().setMapType(mxn.Mapstraction.PHYSICAL);break;default:this.getMxnMap().setMapType(mxn.Mapstraction.ROAD)}};this.initMapSize=this.initMapSize=function(){this.getBgColor()||this.setBgColor("F2F2F2");
var c="100%",a="100%",b="none",f="0px",e="0px";switch(this.getMapPosition()){case "right":c=this.getMapSize()+"%";a="100%";b="left";f=100-this.getMapSize()+"%";break;case "top":c="100%";a=this.getMapSize()+"%";b="none";break;case "bottom":c="100%";a=this.getMapSize()+"%";b="none";e=100-this.getMapSize()+"%";break;default:c=this.getMapSize()+"%",a="100%",b="none"}jQuery("#"+i).css({width:c,height:a,"float":b,left:f,top:e,background:"#"+this.getBgColor(),position:"relative"})};this.initMapLayer=this.initMapLayer=
function(c){c&&(s=c);jQuery("#"+s).css({width:"100%",height:"100%",position:"relative"})};this.initResizableMap=this.initResizableMap=function(){y=l;var c=this.getMapPosition(),a=100-this.getMapSize();this.getBgColor()||this.setBgColor("F2F2F2");var b=0;this.getMapResizable()&&(b=5);var f=jQuery("#"+o).width(),e=jQuery("#"+o).height(),g,d;switch(c){case "right":g="w";d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_vert.png') no-repeat center left; width: 5px; height: 100%; left: 0px; }";
panoContainerCss="#"+o+" #"+k+" { width: "+a+"%; height: 100%; float: left; position: absolute; }";break;case "top":g="s";d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_hori.png') no-repeat bottom center; width: 100%; height: 5px; bottom: 0px; }";panoContainerCss="#"+o+" #"+k+" { width: 100%; height: "+a+"% !important; top: "+this.getMapSize()+"%; float: none; position: absolute; }";break;case "bottom":g="n";d="#"+i+" div.ui-resizable-handle { background: #"+
this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_hori.png') no-repeat top center; width: 100%; height: 5px; top: 0px; }";panoContainerCss="#"+o+" #"+k+" { width: 100%; height: "+a+"% !important; float: none; position: absolute; }";break;default:g="e",d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_vert.png') no-repeat center right; width: 5px; height: 100%; right: 0px; }",panoContainerCss="#"+o+" #"+k+" { width: "+a+"%; height: 100%; float: right; }"}jQuery("<style type='text/css'>#"+
o+" { height: inherit; overflow: hidden; position: relative; }#"+o+":after { clear: both; }"+panoContainerCss+"</style>").appendTo("head");("Explorer"!=kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()&&jQuery("<style type='text/css'>"+d+"</style>").appendTo("head");("Explorer"!=kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()&&jQuery("#"+i).resizable({handles:g,animate:p,ghost:p,containment:"#"+o,maxWidth:f,minWidth:10,maxHeight:e,
minHeight:10});var a=this.forceResizeMapLayer([i]),j=0,m=0;jQuery("#"+k).resize();if(("Explorer"!=kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()){var q=this;a&&(j=a[0],m=a[1],jQuery("#"+i).on("resizestop",function(a,h){var f=jQuery("#"+o),e=100,d=100,i=j,r=m,z="0px",s="0px";switch(c){case "top":d=100*(h.element.height()/f.height());r=h.element.height();q.setMapSize(d);break;case "bottom":d=100*(h.element.height()/f.height());s=100-d+"%";r=h.element.height();q.setMapSize(d);
break;case "right":e=100*(h.element.width()/f.width());z=100-e+"%";i=h.element.width();q.setMapSize(e);break;default:e=100*(h.element.width()/f.width()),i=h.element.width(),q.setMapSize(e)}h.element.css({width:e+"%",height:d+"%",left:z,top:s});switch(c){case "right":g="w";jQuery("#"+k).css({width:100-e+"%",height:d+"%"});f=i-b;r=m;break;case "top":jQuery("#"+k).css("cssText","width: "+e+"%; height: "+(100-d)+"% !important; top: "+d+"%; position: absolute;");f=j;r-=b;break;case "bottom":jQuery("#"+
k).css("cssText","width: "+e+"%; height: "+(100-d)+"% !important;");f=j;r-=b;break;default:g="e",jQuery("#"+k).css({width:100-e+"%",height:d+"%"}),f=i-b,r=m}q.getMxnMap().resizeTo(f,r);jQuery("#"+k).resize()}))}};this.updateResizableMapMaxSize=this.updateResizableMapMaxSize=function(){var a=jQuery("#"+o).width(),b=jQuery("#"+o).height();jQuery("#"+i).resizable("option","maxWidth",a);jQuery("#"+i).resizable("option","maxHeight",b)};this.openCloseMap=this.openCloseMap=function(a){var b=this.getMapPosition(),
d=100-this.getMapSize(),e=y;if("open"==a[0]){e||(this.initMapSize(),this.initMapLayer(),this.initResizableMap());jQuery("#"+i+" div.ui-resizable-handle").css("display","block");jQuery(".mapSwapBox").css("display","block");switch(b){case "top":document.getElementById(i).style.height=this.getMapSize()+"%";jQuery("#"+k).css("cssText","height: "+d+"% !important; top: "+this.getMapSize()+"%;");document.getElementById(i).style.display="block";break;case "bottom":document.getElementById(i).style.height=
this.getMapSize()+"%";jQuery("#"+k).css("cssText","height: "+d+"% !important;");document.getElementById(i).style.display="block";break;default:document.getElementById(i).style.width=this.getMapSize()+"%",document.getElementById(k).style.width=d+"%",document.getElementById(i).style.display="block"}this.forceResizeMapLayer([i])}else switch(jQuery("#"+i+" div.ui-resizable-handle").css("display","none"),jQuery(".mapSwapBox").css("display","none"),b){case "top":case "bottom":jQuery("#"+k).css("cssText",
"height: 100% !important; top:0;");document.getElementById(i).style.height="0%";document.getElementById(i).style.display="none";break;default:document.getElementById(k).style.width="100%",document.getElementById(i).style.width="0%",document.getElementById(i).style.display="none"}jQuery("#"+k).resize();e||(this.getActiveMarker()!=n&&this.getActiveMarker().location?this.getMxnMap().setCenterAndZoom(this.getActiveMarker().location,this.getStartPoint().zoom):this.getMxnMap().setCenterAndZoom(this.getStartPoint().point,
this.getStartPoint().zoom))};this.addSwapSelector=this.addSwapSelector=function(a,b,d,e){var f=this.getMapPosition(),g=b[0].element,j="";if(0<b.length)for(var k=0;k<b.length;k++)j+='<div class="mapDropDownItemDiv '+b[k].element+'" onclick="swapProvider(\''+a+"','"+b[k].element+"','"+b[k].provider+"');document.getElementById('mapDropDownOptionsDiv').style.display = 'none';\">"+b[k].name+"</div>";a="<\!-- MAP SWAP BOX --\><div class=\"mapSwapBox\"><div class=\"mapDropDownControl\" id=\"ddControl\" onclick=\"(document.getElementById('mapDropDownOptionsDiv').style.display == 'block') ? document.getElementById('mapDropDownOptionsDiv').style.display = 'none' : document.getElementById('mapDropDownOptionsDiv').style.display = 'block';\">"+
d+'<img class="mapDropDownArrow" src="'+this.getGraphicsUrl()+'map-arrow-down.png" /></div><div class="mapDropDownOptionsDiv" id="mapDropDownOptionsDiv">'+j+"</div></div>";jQuery(a).prependTo("#"+i);a="position: absolute;";if(e!=n)a+=e;else switch(f){case "top":case "bottom":a+=" left:50%;";break;default:a+=" top:50%;"}jQuery("<style type='text/css'>"+(".mapSwapBox{ width: 90px; margin: 5px; cursor: pointer; text-align: left; z-index: 1000; "+a+" }")+".mapDropDownControl{ direction: ltr; overflow: hidden; text-align: left; position: relative; font-family: Arial, sans-serif; -webkit-user-select: none; font-size: 13px; padding: 1px 6px; border-width: 1px; border-style: solid; border-color: rgb(113, 123, 135); border-image: initial; -webkit-box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; color: rgb(0, 0, 0); font-weight: bold; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: initial initial; background-repeat: initial initial; z-index: 2; }.mapDropDownArrow{ -webkit-user-select: none; border-width: 0px; border-style: initial; border-color: initial; border-image: initial; padding: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; margin-top: -2px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px; }.mapDropDownOptionsDiv{ background-color: white; z-index: 0; padding-top: 2px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-width: 0px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-style: initial; border-right-color: rgb(113, 123, 135); border-bottom-color: rgb(113, 123, 135); border-left-color: rgb(113, 123, 135); border-top-color: initial; border-image: initial; -webkit-box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; position: relative; text-align: left; display: none; }.mapDropDownItemDiv{ font-family: Arial, sans-serif; -webkit-user-select: none; font-size: 13px; padding-top: 2px; padding-right: 5px; padding-bottom: 3px; padding-left: 5px; background-color: rgb(255, 255, 255); color: black; text-transform:capitalize; }.mapDropDownItemDiv:hover, .mapDropDownItemDiv.active{ background-color: rgb(235, 235, 235); }.mapDropDownControl:hover{ background: -webkit-linear-gradient(top,rgb(255,255,255),rgb(230,230,230)); }</style>").appendTo("head");
jQuery(".mapDropDownItemDiv."+g).addClass("active")};this.swapProvider=this.swapProvider=function(a){this.changeProvider(a[0],a[1]);jQuery(".mapDropDownItemDiv").removeClass("active");jQuery(".mapDropDownItemDiv."+a[0]).addClass("active");this.initMapLayer(a[0]);this.forceResizeMapLayer([i])};this.changeDirection=this.changeDirection=function(a){var b=parseFloat(a[0]),a=parseFloat(a[1]);this.getActiveRadar()!=n&&this.getActiveRadar().changeDirection(b,a)};this.changeCurrentMarker=this.changeCurrentMarker=
function(a){this.setActiveMarker(a[0],l,l);void 0!=a[1]&&void 0!=a[2]&&this.changeDirection([a[1],a[2]])};this.unselectCurrentMarker=this.e=function(){this.setActiveMarker(n,p,p)};this.forceResizeMapLayer=this.forceResizeMapLayer=function(a){if(a&&a[0]){var b=jQuery("#"+a[0]).width(),a=jQuery("#"+a[0]).height();"Explorer"==kolorBrowserDetect.browser&&9>kolorBrowserDetect.version&&(b-=1,a-=1);this.getMxnMap().resizeTo(b,a);return[b,a]}return p}};
KolorMap.util={rotation:function(a,g,f,d){d.removeRadar(a);a.currentViewHeading=f;var j=KolorMap.util.generatePolygonPoints(a,g);a.polyline=KolorMap.util.b(j,a,g,f+a.fov,d);d.addRadar(a,p);a.f&&a.activateClick();return a},generatePolygonPoints:function(a,g){var f=g.latConv(),d=g.lonConv(),j=[],e,b=a.heading+(a.fov-a.fovIncidence);for(e=a.heading-a.fovIncidence;e<b;e+=a.quality)j.push([Math.cos(KolorMap.util.a(e))/f,Math.sin(KolorMap.util.a(e))/d]);e>b&&(e=b-1,j.push([Math.cos(KolorMap.util.a(e))/
f,Math.sin(KolorMap.util.a(e))/d]));f=[];d=g.lat;e=g.lon;f.push(new mxn.LatLonPoint(d,e));b=a.radius/1E3;if(a.linkToZoom){b=0;switch(a.currentZoomLevel){case 23:case 22:case 21:b=5;break;case 20:b=10;break;case 19:b=20;break;case 18:b=50;break;case 17:b=100;break;case 16:b=200;break;case 15:b=500;break;case 14:b=1E3;break;case 13:b=2E3;break;case 12:b=2E3;break;case 11:b=5E3;break;case 10:b=1E4;break;case 9:b=2E4;break;case 8:b=5E4;break;case 7:b=1E5;break;case 6:b=2E5;break;case 5:b=5E5;break;case 4:case 3:case 2:case 1:case 0:b=
1E6;break;default:b=2E3}b/=1E3}for(var m=0;m<j.length;m++){var q=new mxn.LatLonPoint(d+b*j[m][0],e+b*j[m][1]);f.push(q)}f.push(new mxn.LatLonPoint(d,e));return f},b:function(a,g,f,d){for(var j=[],e=0;e<a.length;e++){var b=KolorMap.util.d(a[e],f,d);j.push(b)}a=new mxn.Polyline(j);a.setClosed(l);a.setColor(g.color);a.setOpacity(g.opacity);a.setWidth(g.width);a.setFillColor(g.fillColor);a.setFillOpacity(g.fillOpacity);a.api=g.api;return a},d:function(a,g,f){var d=KolorMap.util.distance(g,a),f=KolorMap.util.bearing(g,
a)-f;with(Math){var d=d/6371E3,a=KolorMap.util.a(g.lat),g=KolorMap.util.a(g.lon),j=KolorMap.util.a(f),f=asin(sin(a)*cos(d)+cos(a)*sin(d)*cos(j)),d=atan2(sin(j)*sin(d)*cos(a),cos(d)-sin(a)*sin(f));return new mxn.LatLonPoint(parseFloat(f*(180/PI)),parseFloat(((g-d+PI)%(2*PI)-PI)*(180/PI)))}},a:function(a){return a*(Math.PI/180)},c:function(a){return a*(180/Math.PI)},distance:function(a,g){var f=KolorMap.util.a(a.lat),d=KolorMap.util.a(g.lat),j=d-f,e=KolorMap.util.a(g.lon)-KolorMap.util.a(a.lon),d=Math.log(Math.tan(Math.PI/
4+d/2)/Math.tan(Math.PI/4+f/2)),f=isFinite(j/d)?j/d:Math.cos(f);Math.abs(e)>Math.PI&&(e=0<e?-(2*Math.PI-e):2*Math.PI+e);return 6371E3*Math.sqrt(j*j+f*f*e*e)},bearing:function(a,g){var f=KolorMap.util.a(g.lon)-KolorMap.util.a(a.lon),d=Math.log(Math.tan(Math.PI/4+KolorMap.util.a(g.lat)/2)/Math.tan(Math.PI/4+KolorMap.util.a(a.lat)/2));Math.abs(f)>Math.PI&&(f=0<f?-(2*Math.PI-f):2*Math.PI+f);f=Math.atan2(f,d);return f=(KolorMap.util.c(f)+360)%360}};})();